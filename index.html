<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perpustakaan Digital</title>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --danger: #e63946;
      --light: #f8f9fa;
      --dark: #212529;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    body {
      background-color: #f5f7ff;
      color: var(--dark);
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    h1 {
      color: var(--primary);
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .tabs {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      padding: 10px 20px;
      background: white;
      border: 2px solid var(--primary);
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .tab-btn.active {
      background: var(--primary);
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #495057;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ced4da;
      border-radius: 6px;
      font-size: 1rem;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-success {
      background: var(--success);
      color: var(--dark);
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn:hover {
      opacity: 0.9;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e9ecef;
    }
    
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: var(--dark);
    }
    
    .status-borrowed {
      background: #ffebee;
      color: var(--danger);
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .status-returned {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .actions {
      display: flex;
      gap: 8px;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #adb5bd;
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      table, thead, tbody, th, td, tr {
        display: block;
      }
      
      td {
        position: relative;
        padding-left: 50%;
        text-align: right;
      }
      
      td:before {
        content: attr(data-label);
        position: absolute;
        left: 15px;
        width: 45%;
        padding-right: 10px;
        font-weight: 600;
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸ“š Perpustakaan Digital</h1>
      <p>Kelola koleksi buku dan peminjaman dengan mudah</p>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('books')">ðŸ“š Koleksi Buku</button>
      <button class="tab-btn" onclick="showTab('borrowings')">ðŸŽ« Peminjaman</button>
    </div>

    <!-- Books Tab -->
    <div id="books" class="tab-content active">
      <div class="card">
        <h2>Tambah Buku Baru</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="bookTitle">Judul *</label>
            <input type="text" id="bookTitle" placeholder="Judul buku">
          </div>
          <div class="form-group">
            <label for="bookAuthor">Penulis *</label>
            <input type="text" id="bookAuthor" placeholder="Nama penulis">
          </div>
          <div class="form-group">
            <label for="bookIsbn">ISBN</label>
            <input type="text" id="bookIsbn" placeholder="ISBN (opsional)">
          </div>
          <div class="form-group">
            <label for="bookCategory">Kategori *</label>
            <input type="text" id="bookCategory" placeholder="Fiksi, Non-Fiksi, dll">
          </div>
          <div class="form-group">
            <label for="bookCopies">Jumlah Eksemplar *</label>
            <input type="number" id="bookCopies" min="1" value="1">
          </div>
        </div>
        <button class="btn btn-primary" onclick="addBook()">Tambah Buku</button>
      </div>

      <div class="card">
        <h2>Daftar Buku</h2>
        <div id="booksTable">
          <!-- Buku akan dimuat di sini -->
        </div>
      </div>
    </div>

    <!-- Borrowings Tab -->
    <div id="borrowings" class="tab-content">
      <div class="card">
        <h2>Pinjam Buku</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="borrowBook">Pilih Buku *</label>
            <select id="borrowBook">
              <option value="">-- Pilih buku yang tersedia --</option>
              <!-- Options akan diisi oleh JS -->
            </select>
          </div>
          <div class="form-group">
            <label for="borrowerName">Nama Peminjam *</label>
            <input type="text" id="borrowerName" placeholder="Nama lengkap peminjam">
          </div>
        </div>
        <button class="btn btn-success" onclick="borrowBook()">Pinjam Buku</button>
      </div>

      <div class="card">
        <h2>Riwayat Peminjaman</h2>
        <div id="borrowingsTable">
          <!-- Peminjaman akan dimuat di sini -->
        </div>
      </div>
    </div>
  </div>

  <script src="server.js"></script>
  <script>
    // API Base URL
    const API_BASE = 'https://backend-ten-liard-22.vercel.app/api';

    // Tab Navigation
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
      
      if (tabId === 'books') loadBooks();
      if (tabId === 'borrowings') {
        loadBooksForBorrowing();
        loadBorrowings();
      }
    }

    // â”€â”€â”€ BOOKS FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadBooks() {
      try {
        const res = await fetch(`${API_BASE}/books`);
        const books = await res.json();
        const container = document.getElementById('booksTable');
        
        if (books.length === 0) {
          container.innerHTML = '<div class="empty-state">Belum ada buku di perpustakaan.</div>';
          return;
        }
        
        let html = `<table>
          <thead>
            <tr>
              <th>Judul</th>
              <th>Penulis</th>
              <th>Kategori</th>
              <th>Stok</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>`;
        
        books.forEach(book => {
          html += `
            <tr>
              <td data-label="Judul">${book.title}</td>
              <td data-label="Penulis">${book.author}</td>
              <td data-label="Kategori">${book.category}</td>
              <td data-label="Stok">${book.available_copies} / ${book.total_copies}</td>
              <td data-label="Aksi" class="actions">
                <button class="btn btn-primary" style="padding:6px 10px;font-size:0.9rem;" onclick="editBook(${book.id}, '${book.title}', '${book.author}', '${book.isbn || ''}', '${book.category}', ${book.total_copies})">Edit</button>
                <button class="btn btn-danger" style="padding:6px 10px;font-size:0.9rem;" onclick="deleteBook(${book.id})">Hapus</button>
              </td>
            </tr>`;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (error) {
        document.getElementById('booksTable').innerHTML = '<div class="empty-state">Gagal memuat data buku.</div>';
      }
    }

    async function addBook() {
      const title = document.getElementById('bookTitle').value;
      const author = document.getElementById('bookAuthor').value;
      const isbn = document.getElementById('bookIsbn').value;
      const category = document.getElementById('bookCategory').value;
      const copies = document.getElementById('bookCopies').value;
      
      if (!title || !author || !category || !copies) {
        alert('Harap isi semua field yang wajib!');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/books`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, author, isbn, category, total_copies: parseInt(copies) })
        });
        
        if (res.ok) {
          alert('Buku berhasil ditambahkan!');
          document.getElementById('bookTitle').value = '';
          document.getElementById('bookAuthor').value = '';
          document.getElementById('bookIsbn').value = '';
          document.getElementById('bookCategory').value = '';
          document.getElementById('bookCopies').value = '1';
          loadBooks();
        } else {
          const err = await res.json();
          alert('Gagal: ' + err.error);
        }
      } catch (error) {
        alert('Kesalahan koneksi: ' + error.message);
      }
    }

    function editBook(id, title, author, isbn, category, copies) {
      const newTitle = prompt('Judul:', title);
      const newAuthor = prompt('Penulis:', author);
      const newIsbn = prompt('ISBN:', isbn);
      const newCategory = prompt('Kategori:', category);
      const newCopies = prompt('Jumlah eksemplar:', copies);
      
      if (newTitle && newAuthor && newCategory && newCopies) {
        updateBook(id, newTitle, newAuthor, newIsbn, newCategory, parseInt(newCopies));
      }
    }

    async function updateBook(id, title, author, isbn, category, copies) {
      try {
        const res = await fetch(`${API_BASE}/books/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, author, isbn, category, total_copies: copies })
        });
        
        if (res.ok) {
          alert('Buku berhasil diperbarui!');
          loadBooks();
        } else {
          const err = await res.json();
          alert('Gagal: ' + err.error);
        }
      } catch (error) {
        alert('Kesalahan koneksi: ' + error.message);
      }
    }

    async function deleteBook(id) {
      if (!confirm('Hapus buku ini? Tindakan tidak bisa dibatalkan.')) return;
      
      try {
        const res = await fetch(`${API_BASE}/books/${id}`, { method: 'DELETE' });
        if (res.ok) {
          alert('Buku berhasil dihapus!');
          loadBooks();
        } else {
          const err = await res.json();
          alert('Gagal: ' + err.error);
        }
      } catch (error) {
        alert('Kesalahan koneksi: ' + error.message);
      }
    }

    // â”€â”€â”€ BORROWINGS FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadBooksForBorrowing() {
      try {
        const res = await fetch(`${API_BASE}/books`);
        const books = await res.json();
        const select = document.getElementById('borrowBook');
        select.innerHTML = '<option value="">-- Pilih buku yang tersedia --</option>';
        
        books
          .filter(book => book.available_copies > 0)
          .forEach(book => {
            const option = document.createElement('option');
            option.value = book.id;
            option.textContent = `${book.title} (${book.available_copies} tersedia)`;
            select.appendChild(option);
          });
      } catch (error) {
        console.error('Gagal memuat daftar buku untuk peminjaman');
      }
    }

    async function loadBorrowings() {
      try {
        const res = await fetch(`${API_BASE}/borrowings`);
        const borrowings = await res.json();
        const container = document.getElementById('borrowingsTable');
        
        if (borrowings.length === 0) {
          container.innerHTML = '<div class="empty-state">Belum ada riwayat peminjaman.</div>';
          return;
        }
        
        let html = `<table>
          <thead>
            <tr>
              <th>Buku</th>
              <th>Peminjam</th>
              <th>Tanggal Pinjam</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>`;
        
        borrowings.forEach(b => {
          html += `
            <tr>
              <td data-label="Buku">${b.book_title} oleh ${b.book_author}</td>
              <td data-label="Peminjam">${b.borrower_name}</td>
              <td data-label="Tanggal Pinjam">${new Date(b.borrow_date).toLocaleDateString('id-ID')}</td>
              <td data-label="Status">
                <span class="status-${b.status}">${b.status === 'borrowed' ? 'Dipinjam' : 'Dikembalikan'}</span>
              </td>
              <td data-label="Aksi" class="actions">
                ${b.status === 'borrowed' ? 
                  `<button class="btn btn-success" style="padding:6px 10px;font-size:0.9rem;" onclick="returnBook(${b.id})">Kembalikan</button>
                   <button class="btn btn-danger" style="padding:6px 10px;font-size:0.9rem;" onclick="cancelBorrowing(${b.id})">Batal</button>` : 
                  '<em>Sudah dikembalikan</em>'
                }
              </td>
            </tr>`;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
      } catch (error) {
        document.getElementById('borrowingsTable').innerHTML = '<div class="empty-state">Gagal memuat riwayat peminjaman.</div>';
      }
    }

    async function borrowBook() {
      const bookId = document.getElementById('borrowBook').value;
      const borrowerName = document.getElementById('borrowerName').value;
      
      if (!bookId || !borrowerName) {
        alert('Harap pilih buku dan isi nama peminjam!');
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/borrowings`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ book_id: parseInt(bookId), borrower_name: borrowerName })
        });
        
        if (res.ok) {
          alert('Buku berhasil dipinjam!');
          document.getElementById('borrowerName').value = '';
          loadBooks();
          loadBorrowings();
          loadBooksForBorrowing();
        } else {
          const err = await res.json();
          alert('Gagal: ' + err.error);
        }
      } catch (error) {
        alert('Kesalahan koneksi: ' + error.message);
      }
    }

    async function returnBook(id) {
      if (!confirm('Konfirmasi pengembalian buku?')) return;
      
      try {
        const res = await fetch(`${API_BASE}/borrowings/${id}/return`, { method: 'PUT' });
        if (res.ok) {
          alert('Buku berhasil dikembalikan!');
          loadBooks();
          loadBorrowings();
        } else {
          const err = await res.json();
          alert('Gagal: ' + err.error);
        }
      } catch (error) {
        alert('Kesalahan koneksi: ' + error.message);
      }
    }

    async function cancelBorrowing(id) {
      if (!confirm('Batalkan peminjaman ini?')) return;
      
      try {
        const res = await fetch(`${API_BASE}/borrowings/${id}`, { method: 'DELETE' });
        if (res.ok) {
          alert('Peminjaman berhasil dibatalkan!');
          loadBooks();
          loadBorrowings();
        } else {
          const err = await res.json();
          alert('Gagal: ' + err.error);
        }
      } catch (error) {
        alert('Kesalahan koneksi: ' + error.message);
      }
    }

    // Initialize
    loadBooks();
  </script>
</body>
</html>